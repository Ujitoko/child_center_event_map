const {
  ADACHI_SOURCE,
  ARAKAWA_SOURCE,
  BUNKYO_SOURCE,
  CHOFU_SOURCE,
  CHUO_SOURCE,
  EDOGAWA_SOURCE,
  ITABASHI_SOURCE,
  KATSUSHIKA_SOURCE,
  KOTO_SOURCE,
  NAKANO_SOURCE,
  NERIMA_SOURCE,
  SHINJUKU_SOURCE,
  SUGINAMI_SOURCE,
  SUMIDA_SOURCE,
  TAITO_SOURCE,
  TOSHIMA_SOURCE,
  WARD_CHILD_HINT_RE,
  WARD_EVENT_WORD_RE,
  FUCHU_SOURCE,
  KOGANEI_SOURCE,
  NISHITOKYO_SOURCE,
  MACHIDA_SOURCE,
  FUSSA_SOURCE,
  MUSASHIMURAYAMA_SOURCE,
  AKIRUNO_SOURCE,
  KOMAE_SOURCE,
} = require("./wards");
const { buildListCalendarUrl } = require("../server/ward-parsing");
const { getDaysInMonth } = require("../server/date-utils");

function buildAdditionalWardConfigs(deps) {
  const { fetchBunkyoJidokanSeedUrls } = deps;

  return {
    chuo: {
      source: CHUO_SOURCE,
      listUrls: (m) => [
        `${CHUO_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&event_target=1`,
        `${CHUO_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&event_target=2`,
        `${CHUO_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u5b50\u3069\u3082")}`,
        `${CHUO_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u5150\u7ae5")}`,
        `${CHUO_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u89aa\u5b50")}`,
        `${CHUO_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=1&year=${m.year}&month=${m.month}`,
      ],
      oneTimeListUrls: () => Promise.resolve([
        `${CHUO_SOURCE.baseUrl}/a0025/kosodate/kosodate/shien/jidoukan/tukijijidoukan.html`,
        `${CHUO_SOURCE.baseUrl}/a0025/kosodate/kosodate/shien/jidoukan/sinkawajidoukan.html`,
        `${CHUO_SOURCE.baseUrl}/a0025/kosodate/kosodate/shien/jidoukan/horidomecyoujidoukan.html`,
        `${CHUO_SOURCE.baseUrl}/a0025/kosodate/kosodate/shien/jidoukan/hamacyoujidoukan.html`,
        `${CHUO_SOURCE.baseUrl}/a0025/kosodate/kosodate/shien/jidoukan/tukudajidoukan.html`,
        `${CHUO_SOURCE.baseUrl}/a0025/kosodate/kosodate/shien/jidoukan/tukishimajidoukan.html`,
        `${CHUO_SOURCE.baseUrl}/a0025/kosodate/kosodate/shien/jidoukan/kachidokijidoukan.html`,
        `${CHUO_SOURCE.baseUrl}/a0025/kosodate/kosodate/shien/jidoukan/harumijidoukan.html`,
      ]),
      parseOpts: {
        blockRe: /<div id="tmp_event_cal_list">([\s\S]*?)<div id="event_cal_list_end_position">/i,
        urlAllow: /city\.chuo\.lg\.jp\/.+\.(?:html?|php|pdf)(?:\?|$)/i,
        urlDeny: /\/(?:index|sitemap)\.html$/i,
        useAnchorFallback: true,
        fallbackWhenRowsExist: true,
      },
      requirePreHint: false,
      relaxChildFilter: true,
      titleDenyRe:
        /(サイトマップ|アクセシビリティ|ウェブアクセシビリティ|個人情報|プライバシーポリシー|このサイトについて|ご利用にあたって|携帯サイト|組織から探す|よくある質問|並び順変更|文字サイズ|区役所案内|ホームページの|このホームページの|^中央区役所$|ゲートキーパー|^お問い合わせ$|介護者教室|おしらせ.*PDF|^リンク集$)/i,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      allowPdfDetail: true,
      maxRows: 700,
    },
    bunkyo: {
      source: BUNKYO_SOURCE,
      listUrls: (m) => [
        `${BUNKYO_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&event_target=1`,
        `${BUNKYO_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&event_target=2`,
        `${BUNKYO_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}`,
      ],
      oneTimeListUrls: () => fetchBunkyoJidokanSeedUrls(),
      parseOpts: {
        urlAllow:
          /city\.bunkyo\.lg\.jp\/(?:kosodatekyouiku\/.+\.(?:html?|pdf)|b050\/p\d+\.html)(?:\?|$)/i,
        urlDeny: /\/(?:index|sitemap)\.html$|\/b050\/p002413\.html|tsutaeru\.cloud/i,
        useAnchorFallback: true,
        fallbackWhenRowsExist: true,
      },
      requirePreHint: false,
      relaxChildFilter: false,
      titleDenyRe:
        /(サイトマップ|ウェブアクセシビリティ|個人情報保護|このサイトについて|ご利用にあたって|お問い合わせ一覧|組織から探す|よくある質問|携帯サイト|ページID検索|表紙[・、]目次|^表紙$|^目次$|^本文$|参考資料[（(]|報告書|答申|計画[（(].*PDF|概要版|プラン[）)）].*PDF|会議録|議事要旨|議事録|条例|規則|要綱|ルールとマナー|民間学童クラブ|検討部会|設立の手引き|あり方に関する|やさしい日本語|子ども110番|^やん\s*ぐ$|アフタースクール|^1月の予定$|^おたより$|令和\s*\d+\s*年度.*文京区|令\s*\(\s*れい\s*\)\s*和|指定管理者.*募集|不動産.*募集|^育成室.*について$|過去に開催された|^児童に関すること$)/i,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      allowPdfDetail: true,
      preferPdfRows: true,
      maxRows: 420,
    },
    taito: {
      source: TAITO_SOURCE,
      listUrls: (m, now) => [
        buildListCalendarUrl(`${TAITO_SOURCE.baseUrl}/event/kosodate/calendar`, m, now),
        buildListCalendarUrl(`${TAITO_SOURCE.baseUrl}/event/calendar`, m, now),
        buildListCalendarUrl(`${TAITO_SOURCE.baseUrl}/event/shogaigakushu/calendar`, m, now),
        buildListCalendarUrl(`${TAITO_SOURCE.baseUrl}/library/news/event_news/calendar`, m, now),
        `${TAITO_SOURCE.baseUrl}/event/kosodate/index.html`,
        `${TAITO_SOURCE.baseUrl}/library/kodomo/index.html`,
      ],
      parseOpts: {
        blockRe: /<table[^>]*id="calendarlist"[^>]*>([\s\S]*?)<\/table>/i,
        urlAllow:
          /city\.taito\.lg\.jp\/(?:event|library\/(?:kodomo|news\/event_news)|kosodate|kodomo|jidokan|jido)\/.+\.(?:html?|php|pdf)(?:\?|$)/i,
        urlDeny:
          /\/index\.html$|\/(?:list_)?calendar(?:\d+)?\.html$|\/library\/kodomo\/(?:allNewsList\.html|kodomo_news\/|osusume\/)|(?:\u65b0\u3057\u3044\u672c\u306e\u30ea\u30b9\u30c8|\u5168\u65b0\u7740\u4e00\u89a7|\u304a\u3059\u3059\u3081\u30d6\u30c3\u30af\u30ea\u30b9\u30c8|\u3053\u306e\u672c\u3088\u3093\u3060|\u8aad\u307f\u805e\u304b\u305b\u306b\u5411\u304f\u7d75\u672c\u30ea\u30b9\u30c8|\u8abf\u3079\u5b66\u7fd2\u306e\u624b\u5f15\u304d|\u3054\u5bb6\u5ead\u3067\u306e\u8aad\u307f\u805e\u304b\u305b|\u304a\u3059\u3059\u3081\u8cc7\u6599\u306e\u3054\u6848\u5185)/i,
        useAnchorFallback: true,
        fallbackWhenRowsExist: true,
      },
      requirePreHint: false,
      relaxChildFilter: true,
      titleDenyRe:
        /(新しい本のリスト|全新着一覧|おすすめブックリスト|この本よんだ|読み聞かせに向く絵本リスト|調べ学習の手引き|ご家庭での読み聞かせ|おすすめ資料のご案内|しゃべり場たいとう|日本語スピーチ交流会)/i,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      allowPdfDetail: true,
      preferPdfRows: true,
      maxRows: 900,
    },
    sumida: {
      source: SUMIDA_SOURCE,
      listUrls: (m, now) => [
        buildListCalendarUrl(`${SUMIDA_SOURCE.baseUrl}/eventcalendar/kodomo_kosodate/calendar`, m, now),
        buildListCalendarUrl(`${SUMIDA_SOURCE.baseUrl}/eventcalendar/calendar`, m, now),
        `${SUMIDA_SOURCE.baseUrl}/kosodate/jidoukan/index.html`,
        `${SUMIDA_SOURCE.baseUrl}/kosodate/kosodate_hiroba/index.html`,
      ],
      parseOpts: {
        blockRe: /<table[^>]*id="calendarlist"[^>]*>([\s\S]*?)<\/table>/i,
        urlAllow: /city\.sumida\.lg\.jp\/.+\.(?:html?|php|pdf)(?:\?|$)/i,
        urlDeny: /\/(?:index|sitemap)\.html$/i,
        useAnchorFallback: true,
        fallbackWhenRowsExist: true,
      },
      requirePreHint: false,
      relaxChildFilter: true,
      titleDenyRe:
        /(すみだモダンコミュニティ|フードドライブ|すみだランフェスタ|手ぶらで魚つり|分譲マンション.*相談|区民スポーツ教室|おとなの伝統工芸|働く人対象講座|千葉大学区民向け公開講座|男女共同参画推進啓発|食品衛生実務|ゲートキーパー養成|認知症サポーター養成)/i,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      allowPdfDetail: true,
      maxRows: 700,
    },
    koto: {
      source: KOTO_SOURCE,
      listUrls: (m, now) => [
        `${KOTO_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&event_category=2`,
        `${KOTO_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}`,
        `${KOTO_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=1&year=${m.year}&month=${m.month}`,
        buildListCalendarUrl(`${KOTO_SOURCE.baseUrl}/event/kosodate/calendar`, m, now),
        `${KOTO_SOURCE.baseUrl}/kodomo/index.html`,
      ],
      parseOpts: {
        blockRe: /<table[^>]*class="event_cal_list"[^>]*>([\s\S]*?)<\/table>/i,
        urlAllow: /city\.koto\.lg\.jp\/.+\.(?:html?|php|pdf)(?:\?|$)/i,
        urlDeny: /\/(?:index|sitemap)\.html$/i,
        useAnchorFallback: true,
        fallbackWhenRowsExist: true,
      },
      requirePreHint: false,
      relaxChildFilter: true,
      titleDenyRe:
        /(サイトマップ|ウェブアクセシビリティ|個人情報保護|このサイトについて|ご利用にあたって|お問い合わせ一覧|組織から探す|よくある質問|ページ番号検索|文字サイズ|プライバシー|^RSS|著作権|児童手当|校庭遊び場|小学校教員|地域学校協働|コミュニティ・スクール|放課後こどもプラン|高齢者スマートフォン|高齢者スマホ|^選挙$|マンション再生|法律.*相談|食の安全|バードウォッチング|難病講演会|パラスポーツ体験|こうとうゆーすてっぷ|江東こどもまつり.*協賛|ウィークエンドスクール|みどりのカーテン|^リンク集$|区役所へのアクセス|こども家庭センター.*のご案内|リサイクル講座.*清掃工場|学校選択.*抽選校の状況)/i,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      allowPdfDetail: true,
      preferPdfRows: true,
      maxRows: 700,
    },
    nakano: {
      source: NAKANO_SOURCE,
      listUrls: (m, now) => [
        `${NAKANO_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u5b50\u3069\u3082")}`,
        `${NAKANO_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u5150\u7ae5")}`,
        `${NAKANO_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u89aa\u5b50")}`,
        `${NAKANO_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u5b50\u80b2\u3066")}`,
        `${NAKANO_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&event_target=1`,
        `${NAKANO_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=1&year=${m.year}&month=${m.month}`,
        buildListCalendarUrl(`${NAKANO_SOURCE.baseUrl}/event/kosodate/calendar`, m, now),
        buildListCalendarUrl(`${NAKANO_SOURCE.baseUrl}/event/calendar`, m, now),
        `${NAKANO_SOURCE.baseUrl}/kosodate/event/index.html`,
        `${NAKANO_SOURCE.baseUrl}/kurashi/bunka/bunka/kodomowakamono_bunka/index.html`,
      ],
      parseOpts: {
        blockRe: /<table[^>]*id="calendarlist"[^>]*>([\s\S]*?)<\/table>/i,
        urlAllow: /city\.tokyo-nakano\.lg\.jp\/(?:event|kosodate|kurashi\/bunka\/bunka\/kodomowakamono_bunka)\/.+\.(?:html?|php|pdf)(?:\?|$)/i,
        urlDeny: /\/index\.html$/i,
        useAnchorFallback: true,
        fallbackWhenRowsExist: true,
      },
      requirePreHint: false,
      relaxChildFilter: true,
      titleDenyRe:
        /(創業セミナー|高齢者・障害者の人権|ランニングフェスタ)/i,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      allowPdfDetail: true,
      maxRows: 700,
    },
    suginami: {
      source: SUGINAMI_SOURCE,
      listUrls: (m) => [
        `${SUGINAMI_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u5b50\u3069\u3082")}`,
        `${SUGINAMI_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u5150\u7ae5")}`,
        `${SUGINAMI_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u89aa\u5b50")}`,
        `${SUGINAMI_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u5b50\u80b2\u3066")}`,
        `${SUGINAMI_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}`,
        `${SUGINAMI_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=1&year=${m.year}&month=${m.month}`,
      ],
      parseOpts: {
        blockRe: /<div id="tmp_event_cal_list">([\s\S]*?)<div id="event_cal_list_end_position">/i,
        urlAllow: /city\.suginami\.tokyo\.jp\/s\d+\/event\/\d+\.html(?:\?|$)/i,
        urlDeny: /\/(?:index|sitemap)\.html$|\/about\/|\/aboutweb\//i,
        useAnchorFallback: true,
        fallbackWhenRowsExist: true,
      },
      requirePreHint: false,
      relaxChildFilter: false,
      ignoreUrlHint: true,
      titleDenyRe: /(文字サイズ|色合い変更|Multilingual|検索の方法|ページID検索|まちの湯健康事業|荻窪イルミネーション|荻外荘展示棟|すぎなみコレクション|NEWSTART健康セミナー|シルバー人材センター|原水爆禁止署名|自立サポート体操教室)/i,
      eventWordRe: WARD_EVENT_WORD_RE,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      allowPdfDetail: true,
      preferPdfRows: true,
      skipOnlineOnlyWithoutPlace: true,
      maxRows: 900,
    },
    toshima: {
      source: TOSHIMA_SOURCE,
      listUrls: (m) => {
        const base = [
          `${TOSHIMA_SOURCE.baseUrl}/cgi-bin/event_cal/calendar.cgi?type=2&year=${m.year}&month=${m.month}&page_target=1`,
          `${TOSHIMA_SOURCE.baseUrl}/cgi-bin/event_cal/calendar.cgi?type=2&year=${m.year}&month=${m.month}&page_target=0`,
          `${TOSHIMA_SOURCE.baseUrl}/cgi-bin/event_cal/calendar.cgi?type=2&year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u5b50\u3069\u3082")}`,
          `${TOSHIMA_SOURCE.baseUrl}/cgi-bin/event_cal/calendar.cgi?type=2&year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u5150\u7ae5")}`,
        ];
        const dayUrls = [];
        const days = getDaysInMonth(m.year, m.month);
        for (let d = 1; d <= days; d += 1) {
          dayUrls.push(`${TOSHIMA_SOURCE.baseUrl}/cgi-bin/event_cal/calendar.cgi?type=3&year=${m.year}&month=${m.month}&day=${d}`);
        }
        return [...base, ...dayUrls];
      },
      parseOpts: {
        blockRe: /<div id="tmp_event_cal_list">([\s\S]*?)<div id="event_cal_list_end_position">/i,
        urlAllow: /city\.toshima\.lg\.jp\/.+\.(?:html?|php|pdf)(?:\?|$)/i,
        urlDeny: /\/(?:index|sitemap)\.html$|\/(?:search_result|privacy|link|idkensaku)\.html$|\/012\/kuse\/koho\/|\/chosha\//i,
        useAnchorFallback: true,
        fallbackWhenRowsExist: true,
      },
      requirePreHint: false,
      relaxChildFilter: true,
      titleDenyRe:
        /(介護に関する入門的研修|コミュニティ大学|発達障害講演会|ヒアリングフレイル|男女共同参画.*宣言|コールセンター.*案内|相続登記|空き家セミナー|ひきこもり相談|女性起業家|マンション管理セミナー|IKEBUS)/i,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      allowPdfDetail: true,
      preferPdfRows: true,
      maxRows: 900,
    },
    arakawa: {
      source: ARAKAWA_SOURCE,
      listUrls: (m) => [
        `${ARAKAWA_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&event_category=2&event_target=1`,
        `${ARAKAWA_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&event_target=1`,
        `${ARAKAWA_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&event_target=2`,
        `${ARAKAWA_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u5b50\u3069\u3082")}`,
        `${ARAKAWA_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u5150\u7ae5")}`,
        `${ARAKAWA_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}`,
        `${ARAKAWA_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=1&year=${m.year}&month=${m.month}`,
      ],
      parseOpts: {
        blockRe: /<ul class="event_item_list">([\s\S]*?)<\/ul>/i,
        urlAllow: /city\.arakawa\.tokyo\.jp\/a\d+\/(?:event|kosodate|hirobakan|shougaievent|shougaigakushuu|bunkageijutsu|sport)\/[^?#]+\.html(?:\?|$)/i,
        urlDeny: /\/(?:index|sitemap)\.html$|\/(?:moji|multilingual|kensakuhouhou|page_id|kinkyuji\/kinkyujoho)\.html$/i,
        useAnchorFallback: true,
        fallbackWhenRowsExist: true,
      },
      requirePreHint: false,
      relaxChildFilter: true,
      titleDenyRe: /(文字サイズ|色合い変更|Multilingual|検索の方法|ページID検索|防災・緊急情報|ディスカバーあらかわ|スマホで仲間づくり|パラスポーツフェスティバル)/i,
      childHintRe: WARD_CHILD_HINT_RE,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      maxRows: 700,
    },
    itabashi: {
      source: ITABASHI_SOURCE,
      listUrls: (m) => [
        `${ITABASHI_SOURCE.baseUrl}/kosodate/1000930/index.html`,
        `${ITABASHI_SOURCE.baseUrl}/kosodate/1000930/etc/`,
        `${ITABASHI_SOURCE.baseUrl}/kosodate/1000930/etc/index.html`,
        `${ITABASHI_SOURCE.baseUrl}/kosodate/asobiba/jidoukan/index.html`,
        `${ITABASHI_SOURCE.baseUrl}/kosodate/asobiba/jidoukan/1047271.html`,
        `${ITABASHI_SOURCE.baseUrl}/kosodate/asobiba/jidoukan/1053207.html`,
        `${ITABASHI_SOURCE.baseUrl}/cgi-bin/event/event.cgi?year=${m.year}&month=${m.month}&day=1&mode_link=1&prev=1&c50=50`,
        `${ITABASHI_SOURCE.baseUrl}/cgi-bin/event/event.cgi?year=${m.year}&month=${m.month}&day=1&mode_link=2&prev=1&c50=50`,
        `${ITABASHI_SOURCE.baseUrl}/cgi-bin/event/event.cgi?year=${m.year}&month=${m.month}&day=1&mode_link=2&prev=2&c50=50`,
        `${ITABASHI_SOURCE.baseUrl}/cgi-bin/event/event.cgi?&prev=2&c50=50`,
      ],
      oneTimeListUrls: () => {
        const caps = [
          "akatsuka", "azusawa", "ooyama", "kamiitabashi", "koubai", "sakaue",
          "shimizu", "shimura", "shimurabashi", "shirasagi", "shinkawagishi",
          "takashimadaira", "toshin", "narimasu", "nishitokuji", "hasune",
          "hasune2", "hasunomi", "hikawa", "fujimidai", "midorigaoka",
          "minamimaeno", "minamiitabashi", "mukaihara", "yayoi", "yurinoki",
        ];
        return Promise.resolve(caps.map((c) => `${ITABASHI_SOURCE.baseUrl}/kosodate/asobiba/jidoukan/${c}/index.html`));
      },
      parseOpts: {
        urlAllow:
          /city\.itabashi\.tokyo\.jp\/(?:kosodate\/(?:1000930|asobiba\/jidoukan)|_res\/projects\/default_project\/_page_)\/.+\.(?:html?|pdf)(?:\?|$)/i,
        urlDeny: /\/(?:index|sitemap)\.html$|\/cgi-crm\//i,
        useAnchorFallback: true,
        fallbackWhenRowsExist: true,
      },
      requirePreHint: false,
      relaxChildFilter: true,
      titleDenyRe: /(臨時休館.*お知らせ|児童館の臨時休館)/i,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      allowPdfDetail: true,
      maxRows: 900,
    },
    nerima: {
      source: NERIMA_SOURCE,
      listUrls: () => [
        `${NERIMA_SOURCE.baseUrl}/kosodatekyoiku/kodomo/jidokan/index.html`,
        `${NERIMA_SOURCE.baseUrl}/kosodatekyoiku/kodomo/jidokan/nikoniko/nerima.html`,
        `${NERIMA_SOURCE.baseUrl}/kosodatekyoiku/kodomo/jidokan/nikoniko/shakuiji.html`,
        `${NERIMA_SOURCE.baseUrl}/kosodatekyoiku/kodomo/jidokan/nikoniko/oizumi.html`,
        `${NERIMA_SOURCE.baseUrl}/kosodatekyoiku/kodomo/jidokan/nikoniko/hikarigaoka.html`,
        `${NERIMA_SOURCE.baseUrl}/shisetsu/hokenfuku/fukushi/koseibunka/jido/club_gyouji.html`,
        `${NERIMA_SOURCE.baseUrl}/kankomoyoshi/event/kodomo/index.html`,
        `${NERIMA_SOURCE.baseUrl}/kosodatekyoiku/kodomo/asobi/kodomo_cafe.html`,
        `${NERIMA_SOURCE.baseUrl}/kosodatekyoiku/kodomo/asobi/terrace.html`,
        `${NERIMA_SOURCE.baseUrl}/kosodatekyoiku/kodomo/asobi/ohipiyo.html`,
        `${NERIMA_SOURCE.baseUrl}/kosodatekyoiku/kodomo/asobi/sotoasobi.html`,
        `${NERIMA_SOURCE.baseUrl}/kosodatekyoiku/kodomo/asobi/akachan.html`,
        `${NERIMA_SOURCE.baseUrl}/kosodatekyoiku/kodomo/asobi/hiroba.html`,
        `${NERIMA_SOURCE.baseUrl}/kosodatekyoiku/kodomo/asobi/kaiho.html`,
        `${NERIMA_SOURCE.baseUrl}/kosodatekyoiku/kodomo/asobi/nobinobihiroba.html`,
        `${NERIMA_SOURCE.baseUrl}/kosodatekyoiku/kodomo/asobi/ouchicafe.html`,
      ],
      oneTimeListUrls: () => {
        const facilities = [
          "heiwadai", "sakaecho", "shakujii_jidokan", "kitaoizumi",
          "hikarigaoka", "kamishakujii", "doshida_jidokan", "harunohi",
          "nakamura_jidokan", "minamitanaka", "kitamachi", "sekimachi",
          "higashioizumi", "shakujiidai", "nishioizumi", "miharadai", "nakayoshi",
        ];
        return Promise.resolve(facilities.map((f) => `${NERIMA_SOURCE.baseUrl}/kosodatekyoiku/kodomo/jidokan/${f}/index.html`));
      },
      parseOpts: {
        urlAllow:
          /city\.nerima\.tokyo\.jp\/(?:kosodatekyoiku\/kodomo\/(?:jidokan|asobi)|shisetsu\/hokenfuku\/fukushi\/koseibunka\/jido|kankomoyoshi\/event\/kodomo)\/.+\.(?:html?|php|pdf)(?:\?|$)/i,
        urlDeny:
          /\/(?:sitemap)\.html$|\/photo\.html$|\/riyou-annai\.html$|\/(?:riyoannai|nyuyoji_hogosha|tyuukousei2017|hogosyanominasama|minnkanngakudou|hoikunorekishi|kosooutokyopassport|birthdaysupport|nerijiten)\.html$/i,
        useAnchorFallback: true,
        fallbackWhenRowsExist: true,
      },
      rowUrlAllowRe:
        /city\.nerima\.tokyo\.jp\/(?:kosodatekyoiku\/kodomo\/(?:jidokan|asobi)|shisetsu\/hokenfuku\/fukushi\/koseibunka\/jido|kankomoyoshi\/event\/kodomo)\/.+\.(?:html?|php|pdf)(?:\?|$)/i,
      rowUrlDenyRe:
        /\/(?:sitemap)\.html$|\/photo\.html$|\/riyou-annai\.html$|\/(?:riyoannai|nyuyoji_hogosha|tyuukousei2017|hogosyanominasama|minnkanngakudou|hoikunorekishi|kosooutokyopassport|birthdaysupport|nerijiten)\.html$/i,
      requirePreHint: false,
      relaxChildFilter: true,
      titleDenyRe:
        /(りようあんない|利用案内|対応$|民間学童クラブ事業|保育の歴史とこれから|お問い合わせ|Multilingual|モバイル|サイトマップ|カレンダー|^イベント一覧$|イベント情報一覧|このサイトについて|組織と業務案内|アクセシビリティ|新着情報一覧|施設案内|施設紹介|館内のご紹介|への地図|への行き方|アクセス（|Q＆A|活動紹介|活動のご紹介|活動のご案内|おもちゃライブラリー|図書コーナーの写真|画像で見る児童館|目的利用マップ|中高生の居場所づくり事業|居場所づくり事業「|子育ての広場 「にこにこ」|おひさまぴよぴよ|ワイワイランド|児童館地域（PDF|おやこ子育ての広場 「にこにこ」 〒|おたより|お便り|じどうしつだより|児童館だより|児童館たより|中高生たより|中高生タイムス|ひよこだより|たより（PDF|^お知らせ$|^児童室$|メンバー制クラブ|^小学生以上のお友だちへ$|^小学生以上対象事業$|^乳幼児対象事業$|^今月のいつでも参加クラブ$|^今月のイチ推しニュース$|^ナカルングランデ|^児童向け活動|^幼児向け活動|^乳幼児向け活動|^南田中児童館の|^栄町児童館 乳幼児|^子育てのひろば|ぴよぴよ$|大きな地震|ねりまのじどうかん|準備期間.*臨時休館|臨時休館.*お知らせ)/i,
      childHintRe: WARD_CHILD_HINT_RE,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      allowPdfDetail: true,
      maxRows: 900,
    },
    adachi: {
      source: ADACHI_SOURCE,
      listUrls: (m) => [
        `${ADACHI_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=1&year=${m.year}&month=${m.month}`,
        `${ADACHI_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&event_target=1`,
        `${ADACHI_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&event_target=2`,
        `${ADACHI_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u5b50\u3069\u3082")}`,
        `${ADACHI_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u5150\u7ae5")}`,
        `${ADACHI_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u89aa\u5b50")}`,
        `${ADACHI_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("子育て")}`,
        `${ADACHI_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("赤ちゃん")}`,
        `${ADACHI_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}`,
      ],
      parseOpts: {
        blockRe: /<table[^>]*class="event_cal_7w"[^>]*>([\s\S]*?)<\/table>/i,
        urlAllow: /city\.adachi\.tokyo\.jp\/.+\.(?:html?|php|pdf)(?:\?|$)/i,
        urlDeny: /\/(?:index|sitemap|search_index)\.html/i,
        useAnchorFallback: true,
        fallbackWhenRowsExist: true,
      },
      titleDenyRe: /(サイトマップ|アクセシビリティ|個人情報|プライバシー|ウェブアクセシビリティ|リンク集|詳細ページ|区役所へのアクセス|施設案内|よくある質問|お問い合わせ|サイト内検索|多重債務|消費者団体)/i,
      requirePreHint: false,
      relaxChildFilter: true,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      allowPdfDetail: true,
      maxRows: 900,
    },
    katsushika: {
      source: KATSUSHIKA_SOURCE,
      listUrls: (m) => [
        // cate=21 (児童館) は katsushika-schedule.js が担当
        `${KATSUSHIKA_SOURCE.baseUrl}/cgi-bins/event/event.cgi?year=${m.year}&month=${m.month}&cate=20`,
        `${KATSUSHIKA_SOURCE.baseUrl}/cgi-bins/event/event.cgi?year=${m.year}&month=${m.month}&cate=22`,
        `${KATSUSHIKA_SOURCE.baseUrl}/cgi-bins/event/event.cgi?year=${m.year}&month=${m.month}&cate=25`,
        `${KATSUSHIKA_SOURCE.baseUrl}/cgi-bins/event/event.cgi?year=${m.year}&month=${m.month}`,
        `${KATSUSHIKA_SOURCE.baseUrl}/cgi-bins/event/event.cgi?year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u5b50\u3069\u3082")}`,
        `${KATSUSHIKA_SOURCE.baseUrl}/cgi-bins/event/event.cgi?year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u5150\u7ae5")}`,
        `${KATSUSHIKA_SOURCE.baseUrl}/cgi-bins/event/event.cgi?year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u89aa\u5b50")}`,
        `${KATSUSHIKA_SOURCE.baseUrl}/cgi-bins/event/event.cgi?year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u5b50\u80b2\u3066")}`,
      ],
      // oneTimeListUrls removed: katsushika-schedule.js handles facility index pages
      parseOpts: {
        blockRe: /<ul class="listlink">([\s\S]*?)<\/ul>/i,
        urlAllow: /city\.katsushika\.lg\.jp\/(?:event|kosodate|shisetsu)\/.+\.(?:html?|php|pdf)(?:\?|$)/i,
        urlDeny: /\/(?:index|sitemap)\.html$|\/event\/(?:1000114|1022292|1000115)\//i,
        useAnchorFallback: true,
        fallbackWhenRowsExist: true,
      },
      requirePreHint: false,
      relaxChildFilter: true,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      allowPdfDetail: true,
      preferPdfRows: true,
      maxRows: 900,
    },
    edogawa: {
      source: EDOGAWA_SOURCE,
      listUrls: (m) => [
        `${EDOGAWA_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&siteid=6&event_target=1`,
        `${EDOGAWA_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&siteid=6&event_target=2`,
        `${EDOGAWA_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&siteid=6`,
        `${EDOGAWA_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u5b50\u3069\u3082")}`,
        `${EDOGAWA_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}&keyword=${encodeURIComponent("\u5150\u7ae5")}`,
        `${EDOGAWA_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=1&year=${m.year}&month=${m.month}`,
      ],
      parseOpts: {
        urlAllow: /city\.edogawa\.tokyo\.jp\/(?:event|kosodate|shisetsu)\/.+\.(?:html?|pdf)/i,
        urlDeny: /\/(?:index|sitemap)\.html$/i,
        useAnchorFallback: true,
        fallbackWhenRowsExist: true,
      },
      requirePreHint: false,
      relaxChildFilter: true,
      titleDenyRe:
        /(えどがわスポーツサポートクラブ|女性視点でアップデート|小規模保育所就職フェア|あなたが区議会議員)/i,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      allowPdfDetail: true,
      maxRows: 700,
    },
    shinjuku: {
      source: SHINJUKU_SOURCE,
      listUrls: (m) => [
        `${SHINJUKU_SOURCE.baseUrl}/event/calendar/calendar.php?Y=${m.year}&M=${m.month}`,
        `${SHINJUKU_SOURCE.baseUrl}/event/calendar/calendar.php?Y=${m.year}&M=${m.month}&C=5`,
        `${SHINJUKU_SOURCE.baseUrl}/kosodate/index.html`,
      ],
      parseOpts: {
        dayBlockRe: /<div[^>]*class="eventSelectDay[^"]*"[^>]*>[\s\S]*?<p>\s*(\d{1,2})\u65e5[\s\S]*?<ul>([\s\S]*?)<\/ul>[\s\S]*?<\/div>/gi,
        urlAllow: /city\.shinjuku\.lg\.jp\/.+\.(?:html?|php|pdf)(?:\?|$)/i,
        urlDeny: /\/(?:index|sitemap)\.html$/i,
        skipTr: true,
        useAnchorFallback: true,
        fallbackWhenRowsExist: true,
      },
      requirePreHint: false,
      relaxChildFilter: true,
      titleDenyRe:
        /(サイトマップ|ウェブアクセシビリティ|個人情報保護|このサイトについて|ご利用にあたって|お問い合わせ一覧|組織から探す|よくある質問|携帯サイト|検索について|色変更|音声読み上げ|多言語対応|Language|フォントサイズ|文字サイズ|アクセシビリティ方針|^福祉・介護$|^ごみ・資源・環境$|^くらし$|^地域共生・区民活動$|^消費生活・相談$|^道路・交通・自転車$|^住まい$|^健康・衛生$|^産業・商工$|^産業振興・企業支援$|^国際・文化・スポーツ$|^まちづくり$|^防災・防犯$|^芸術・文化・歴史$|^環境・廃棄物$|^雇用・就労支援$|^区政情報$|^届出・届出窓口$|^審査請求|^まちづくり・都市計画$|モバイル新宿区の紹介|^大久保・百人町地区クリーン活動$|転生したら芸術家|SOMPO美術館|ワーク・ライフ・バランス|常任委員会|^選挙$|^施設案内$|新宿文化センターリニューアル|NHK.*公開収録|^行政評価$|^有償刊行物$|^防犯[、,]|^防災$|避難場所・ターミナル|次世代育成協議会|働く女性応援講座|新宿区議会|定例会.*本会議|議会中継|傍聴のご案内|議会だより|請願・陳情|議長・副議長|会派別名簿|議会の仕組み|議決結果一覧|議員報酬|政務活動費|都市計画審議会|健康づくり行動計画推進協議会)/i,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      allowPdfDetail: true,
      skipOnlineOnlyWithoutPlace: true,
      maxRows: 900,
    },
    chofu: {
      source: CHOFU_SOURCE,
      listUrls: (m) => [
        `${CHOFU_SOURCE.baseUrl}/cgi-bin/event_cal_multi/calendar.cgi?type=2&year=${m.year}&month=${m.month}`,
      ],
      parseOpts: {
        blockRe: /<div id="tmp_event_cal_list">([\s\S]*?)<div id="event_cal_list_end_position">/i,
        urlAllow: /city\.chofu\.lg\.jp\/.+\.html?(?:\?|$)/i,
        urlDeny: /\/(?:index|sitemap|404)\.html$/i,
        useAnchorFallback: true,
        fallbackWhenRowsExist: true,
      },
      relaxChildFilter: false,
      requirePreHint: false,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      allowPdfDetail: true,
      maxRows: 900,
      titleDenyRe: /(サイトマップ|個人情報|ウェブアクセシビリティ|RSS配信|入札・契約|パブリック・コメント|附属機関等の会議|交通規制|子宮頸がん|市民公開講座)/i,
      skipOnlineOnlyWithoutPlace: true,
    },
    fuchu: {
      source: FUCHU_SOURCE,
      listUrls: (m, now) => [
        buildListCalendarUrl(`${FUCHU_SOURCE.baseUrl}/event/calendar`, m, now),
      ],
      parseOpts: {
        urlAllow: /city\.fuchu\.tokyo\.jp\/.+\.html?(?:\?|$)/i,
        urlDeny: /\/(?:index|sitemap|404)\.html$/i,
        useAnchorFallback: true,
        fallbackWhenRowsExist: true,
      },
      relaxChildFilter: true,
      requirePreHint: false,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      maxRows: 500,
      titleDenyRe: /(サイトマップ|個人情報|ウェブアクセシビリティ|RSS配信)/i,
    },
    koganei: {
      source: KOGANEI_SOURCE,
      listUrls: () => [
        `${KOGANEI_SOURCE.baseUrl}/kosodatekyoiku/shisetsu/jidokan/jidoukan2/HP.html`,
        `${KOGANEI_SOURCE.baseUrl}/kosodatekyoiku/hoikuen/minnadeasobo.html`,
        `${KOGANEI_SOURCE.baseUrl}/kosodatekyoiku/shisetsu/kodomokateisiensenta/kodomosien.html`,
      ],
      parseOpts: {
        urlAllow: /city\.koganei\.lg\.jp\/kosodatekyoiku\/.+\.(?:html?|php|pdf)(?:\?|$)/i,
        urlDeny: /\/(?:index|sitemap|404)\.html$|hoshanosokuteikekka/i,
        useAnchorFallback: true,
        fallbackWhenRowsExist: true,
      },
      relaxChildFilter: true,
      requirePreHint: false,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      allowPdfDetail: true,
      maxRows: 500,
      titleDenyRe: /(サイトマップ|個人情報|ウェブアクセシビリティ|RSS配信|放射線測定|リンク集|法人番号|休日診療|ホームページについて|市役所へのマップ|安全・安心メール|防災情報|新着情報一覧)/i,
    },
    nishitokyo: {
      source: NISHITOKYO_SOURCE,
      listUrls: (m, now) => [
        buildListCalendarUrl(`${NISHITOKYO_SOURCE.baseUrl}/event/kids_oyakomuke/calendar`, m, now),
      ],
      parseOpts: {
        urlAllow: /city\.nishitokyo\.lg\.jp\/.+\.html?(?:\?|$)/i,
        urlDeny: /\/(?:index|sitemap|404)\.html$|\/aboutweb\/|\/siseizyoho\/|\/event\/[^/]+\/calendar\/list_calendar\.html/i,
        useAnchorFallback: true,
        fallbackWhenRowsExist: true,
      },
      relaxChildFilter: true,
      requirePreHint: false,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      maxRows: 500,
      titleDenyRe:
        /(サイトマップ|個人情報|ウェブアクセシビリティ|RSS配信|^検索の使い方$|^市役所の案内$|^お問い合わせ$)/i,
    },
    machida: {
      source: MACHIDA_SOURCE,
      listUrls: (m, now) => [
        buildListCalendarUrl(`${MACHIDA_SOURCE.baseUrl}/event/kodomo/calendar`, m, now),
      ],
      parseOpts: {
        urlAllow: /city\.machida\.tokyo\.jp\/.+\.html?(?:\?|$)/i,
        urlDeny: /\/(?:index|sitemap|404)\.html$/i,
        useAnchorFallback: true,
        fallbackWhenRowsExist: true,
      },
      relaxChildFilter: true,
      requirePreHint: false,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      maxRows: 500,
      titleDenyRe: /(サイトマップ|個人情報|ウェブアクセシビリティ|RSS配信)/i,
    },
    fussa: {
      source: FUSSA_SOURCE,
      listUrls: (m) => [
        `${FUSSA_SOURCE.baseUrl}/cgi-evt/event.cgi?year=${m.year}&month=${m.month}&cate=6&target=0`,
      ],
      parseOpts: {
        blockRe: /<table[^>]*id="event"[^>]*>([\s\S]*?)<\/table>/i,
        urlAllow: /city\.fussa\.tokyo\.jp\/(?!cgi-evt\/).+\.html?(?:\?|$)/i,
        urlDeny: /\/(?:index|sitemap|404)\.html$|eventsearch\.cgi/i,
        useAnchorFallback: false,
      },
      relaxChildFilter: true,
      requirePreHint: false,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      maxRows: 300,
      titleDenyRe: /(サイトマップ|個人情報|ウェブアクセシビリティ)/i,
    },
    musashimurayama: {
      source: MUSASHIMURAYAMA_SOURCE,
      listUrls: (m) => [
        `${MUSASHIMURAYAMA_SOURCE.baseUrl}/cgi-evt/event.cgi?year=${m.year}&month=${m.month}&cate=4`,
      ],
      parseOpts: {
        blockRe: /<table[^>]*id="event"[^>]*>([\s\S]*?)<\/table>/i,
        urlAllow: /city\.musashimurayama\.lg\.jp\/(?!cgi-evt\/).+\.html?(?:\?|$)/i,
        urlDeny: /\/(?:index|sitemap|404)\.html$|eventsearch\.cgi/i,
        useAnchorFallback: false,
      },
      relaxChildFilter: true,
      requirePreHint: false,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      maxRows: 300,
      titleDenyRe: /(サイトマップ|個人情報|ウェブアクセシビリティ)/i,
    },
    akiruno: {
      source: AKIRUNO_SOURCE,
      listUrls: (m) => {
        const ms = String(m.month).padStart(2, "0");
        return [`${AKIRUNO_SOURCE.baseUrl}/event2/${m.year}${ms}_8.html`];
      },
      parseOpts: {
        blockRe: /<table[^>]*class="calendar_month"[^>]*>([\s\S]*?)<\/table>/i,
        urlAllow: /city\.akiruno\.tokyo\.jp\/(?:kosodate|event2)\/.+\.html?(?:\?|$)/i,
        urlDeny: /\/(?:index|sitemap|404)\.html$/i,
        useAnchorFallback: false,
      },
      relaxChildFilter: true,
      requirePreHint: false,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      maxRows: 300,
      titleDenyRe: /(サイトマップ|個人情報|ウェブアクセシビリティ)/i,
    },
    komae: {
      source: KOMAE_SOURCE,
      listUrls: (m) => {
        const ms = String(m.month).padStart(2, "0");
        return [`${KOMAE_SOURCE.baseUrl}/events/index.cfm/view.4.${m.year}${ms}.2035.html`];
      },
      parseOpts: {
        blockRe: /<div[^>]*id="main(?:contents?|_contents?|_body)?"[^>]*>([\s\S]*?)<\/div>\s*(?:<div[^>]*id="(?:sub|foot))/i,
        urlAllow: /city\.komae\.tokyo\.jp\/events\/index\.cfm\/detail\.\d+\.\d+\.html/i,
        urlDeny: /\/(?:index|sitemap|404)\.html$/i,
        useAnchorFallback: true,
        fallbackWhenRowsExist: true,
      },
      relaxChildFilter: true,
      requirePreHint: false,
      appendFallbackDate: true,
      allowRowFallbackOnDetailError: true,
      maxRows: 300,
      titleDenyRe: /(サイトマップ|個人情報|ウェブアクセシビリティ)/i,
    },
  };
}

module.exports = {
  buildAdditionalWardConfigs,
};
